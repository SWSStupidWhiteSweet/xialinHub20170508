<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>申请退款</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

        <#include "/common/include_head_css.html"/>
        <#include "/common/include_jquery_core.html"/>
        <#include "/common/include_bootstrap_core.html"/>
        <#include "/common/include_ace_core.html"/>
        <#include "/common/include_jqgrid_core.html"/>
        <#include "/common/include_plugin.html"/>
        <#include "/common/include_photo_album.html"/>
        <link rel="stylesheet" href="${basePath}/assets/module/project/css/project.css" />
        <style type="text/css">
            /*流程选择框样式*/
            .cssClass{ text-align:center;
                        margin:0 auto;
                        border:1px solid #F00
            }
            /*图片上传样式*/
            .textLeft{
                text-align: left !important;
                margin: 0px;
                padding-top: 5px;
                font-size: 14px;
                font-weight: 700;
                color: #999999;
                padding-left:0;
                padding-right: 0 !important;
            }
            .msgDiv{
                font-size: 15px;
                height: 35px;
                line-height: 35px;
                background-color: #6fb3e0;
                margin-top:0;
                color: #f5f5f5;
            }
            .cancleY{
                display: inline-block;
                cursor: pointer;
                text-align: center;
                width: 51%;
                background: #EFEFEF no-repeat 0 0;
                color: black;
            }
            .cancleN{
                display: inline-block;
                text-align: center;
                width: 49%;
                color: #f5f5f5;
            }
        </style>
    </head>
    <body class="no-skin">
        <div class="main-container" id="main-container">
            <div class="main-content">
                <div class="page-content">
                    <div class="page-content-area">
                        <div class="page-header">
                            <h1>
                                退款申请
                                <small>
                                    <i class="ace-icon fa fa-angle-double-right"></i>
                                    申请退款
                                </small>
                            </h1>
                        </div>

                        <div class="row">
                            <div class="col-xs-12">
                                <form id="projectForm" class="form-horizontal" role="form">
                                    <input type="hidden" id="projectInfoId" value="" />
                                    <input type="hidden" id="orderInfoId" value="${(orderInfo.orderInfoId)!''}" />
                                    <input type="hidden" id="fingerprint" value="${(orderInfo.fingerprint)!''}" />
                                    <!--退款信息列表数据条数-->
                                    <input type="hidden" id="refundInfoSize" value="${(refundInfoGriddatas?size)!'0'}">

                                    <div class="tab-content no-border padding-5">
                                        <div id="faq-tab-1" class="tab-pane fade in active">
                                            <div class="space-8"></div>
                                            <div id="faq-list-1" class="panel-group accordion-style1 accordion-style2">
                                                <!-- 订单信息 -->
                                                <div class="panel panel-default">
                                                    <div class="panel-heading">
                                                        <a href="#faq-1-3" data-toggle="collapse" class="accordion-toggle" aria-expanded="false">
                                                            <i class="pull-right ace-icon fa fa-chevron-down" data-icon-hide="ace-icon fa fa-chevron-down" data-icon-show="ace-icon fa fa-chevron-left"></i>
                                                            &nbsp; 订单信息
                                                        </a>
                                                    </div>
                                                    <div class="panel-collapse collapse in" id="faq-1-3" aria-expanded="false">
                                                        <div class="panel-body">
                                                            <div class="form-group">
                                                                <div class="row">
                                                                    <div class="col-xs-12 refundInfoGird">
                                                                        <div class="table-responsive"><!--id="sample-table-2"-->
                                                                            <table class="table table-striped table-bordered table-hover">
                                                                                <thead>
                                                                                    <tr>
                                                                                        <th>订单号</th>
                                                                                        <th>商户</th>
                                                                                        <th>项目</th>
                                                                                        <th>客户</th>
                                                                                        <th>报备人</th>
                                                                                        <th>所属门店</th>
                                                                                        <th>认筹套餐</th>
                                                                                        <th>已收认筹金额</th>
                                                                                        <th>认筹日期</th>
                                                                                    </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                    <tr>
                                                                                        <td>${(orderInfo.orderInfoCode)!''}</td>
                                                                                        <td>${(orderInfo.merchantName)!''}</td>
                                                                                        <td>${(orderInfo.projectInfoName)!''}</td>
                                                                                        <td>${(orderInfo.customName)!''}</td>
                                                                                        <td>${(orderInfo.brokerName)!''}</td>
                                                                                        <td>${(orderInfo.storeName)!''}</td>
                                                                                        <td>${(orderInfo.projectPackageName)!''}</td>
                                                                                        <td>${(orderInfo.realAccAmount)!''}</td>
                                                                                        <td>${(orderInfo.groupBuyTime)!''}</td>
                                                                                    </tr>
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 佣金结算信息  -->
                                                <div class="panel panel-default">
                                                    <div class="panel-heading">
                                                        <a href="#faq-1-4" data-toggle="collapse" class="accordion-toggle" aria-expanded="false">
                                                            <i class="pull-right ace-icon fa fa-chevron-down" data-icon-hide="ace-icon fa fa-chevron-down" data-icon-show="ace-icon fa fa-chevron-left"></i>
                                                            &nbsp; 佣金结算信息
                                                        </a>
                                                    </div>
                                                    <div class="panel-collapse collapse in" id="faq-1-4" aria-expanded="false">
                                                        <div class="panel-body">
                                                            <div class="form-group">

                                                                <div class="row">
                                                                    <div class="col-xs-12">
                                                                        <div class="table-responsive">
                                                                            <table class="table table-striped table-bordered table-hover">
                                                                                <thead>
                                                                                <tr>
                                                                                    <th>项目名称</th>
                                                                                    <th>所属城市</th>
                                                                                    <th>佣金类型</th>
                                                                                    <th>结佣对象</th>
                                                                                    <th>结佣对象名称</th>
                                                                                    <th>结佣金额</th>
                                                                                    <th>佣金结算状态</th>
                                                                                </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                <#if orderBrokerageInfos?? && (orderBrokerageInfos?size > 0) >
                                                                                    <#list orderBrokerageInfos as orderBrokerageInfo>
                                                                                        <tr>
                                                                                            <td>${(orderBrokerageInfo.projectInfoName)!''}</td>
                                                                                            <td>${(orderBrokerageInfo.cityName)!''}</td>
                                                                                            <td>${(orderBrokerageInfo.brokerageType)!''}</td>
                                                                                            <td>${(orderBrokerageInfo.brokerageObject)!''}</td>
                                                                                            <td>${(orderBrokerageInfo.brokerageObjectName)!''}</td>
                                                                                            <td>${(orderBrokerageInfo.brokerageDistributionAmount)
                                                                                                !''}</td>
                                                                                            <td>${(orderBrokerageInfo.brokeragerStatusDetail)!''}</td>
                                                                                        </tr>
                                                                                    </#list>
                                                                                </#if>
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 收款信息  -->
                                                <div class="panel panel-default">
                                                    <div class="panel-heading">
                                                        <a href="#faq-1-5" data-toggle="collapse" class="accordion-toggle" aria-expanded="false">
                                                            <i class="pull-right ace-icon fa fa-chevron-down" data-icon-hide="ace-icon fa fa-chevron-down" data-icon-show="ace-icon fa fa-chevron-left"></i>
                                                            &nbsp; 收款信息
                                                        </a>
                                                    </div>
                                                    <div class="panel-collapse collapse in" id="faq-1-5" aria-expanded="false">
                                                        <div class="panel-body">
                                                            <div class="form-group">
                                                                <div class="row">
                                                                    <div class="col-xs-12">
                                                                        <div class="table-responsive">
                                                                            <table class="table table-striped table-bordered table-hover">
                                                                                <thead>
                                                                                <tr>
                                                                                    <th>收款类型</th>
                                                                                    <th>终端编号</th>
                                                                                    <th>交易参考号</th>
                                                                                    <th>开户行</th>
                                                                                    <th>开户行支行</th>
                                                                                    <th>账号</th>
                                                                                    <th>银行卡类型</th>
                                                                                    <th>金额</th>
                                                                                    <th>交易时间</th>
                                                                                    <th>收款用途</th>
                                                                                </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                <#if orderInfoFinanceEbGriddatas?? && (orderInfoFinanceEbGriddatas?size > 0) >
                                                                                    <#list orderInfoFinanceEbGriddatas as orderInfoFinanceEbGriddata>
                                                                                        <tr>
                                                                                            <td>${(orderInfoFinanceEbGriddata.ebAccountDetailTypeDescribe)!''}</td>
                                                                                            <td>${(orderInfoFinanceEbGriddata.posTerminalCode)!''}</td>
                                                                                            <td>${(orderInfoFinanceEbGriddata.tradeRefCode)!''}</td>
                                                                                            <td>${(orderInfoFinanceEbGriddata.payBankName)!''}</td>
                                                                                            <td>${(orderInfoFinanceEbGriddata.bankName)!''}</td>
                                                                                            <td>${(orderInfoFinanceEbGriddata.payAccountNumber)!''}</td>
                                                                                            <td>${(orderInfoFinanceEbGriddata.payAccountType)!''}</td>
                                                                                            <td>${(orderInfoFinanceEbGriddata.distributionAmount)!''}</td>
                                                                                            <td>${((orderInfoFinanceEbGriddata.tradeTime)?string
                                                                                                ("yyyy-MM-dd"))!''}</td>
                                                                                            <td>${(orderInfoFinanceEbGriddata.used)!''}</td>
                                                                                        </tr>
                                                                                    </#list>
                                                                                </#if>
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 退款信息   -->
                                                <div class="panel panel-default">
                                                    <div class="panel-heading">
                                                        <a href="#faq-1-6" data-toggle="collapse" class="accordion-toggle" aria-expanded="false">
                                                            <i class="pull-right ace-icon fa fa-chevron-down" data-icon-hide="ace-icon fa fa-chevron-down" data-icon-show="ace-icon fa fa-chevron-left"></i>
                                                            &nbsp; 退款信息
                                                        </a>
                                                    </div>
                                                    <div class="panel-collapse collapse in" id="faq-1-6" aria-expanded="false">
                                                        <div class="panel-body">
                                                            <div class="form-group">
                                                                <h3  class="lighter red">
                                                                    退款金额：<span id="refundNum">${(orderRefundExtend.sum)!''} </span>
                                                                    &nbsp;&nbsp;&nbsp;
                                                                    退款金额大写:${(orderRefundExtend.upperCaseSum)!''}</h3>
                                                                <div class="tabbable">
                                                                    <ul class="nav nav-tabs" id="myTab">
                                                                        <li class="isToSrc active" value="1">
                                                                            <a data-toggle="tab" id="refund" href="#home">
                                                                                <i class="green icon-home bigger-110"></i>
                                                                                原卡退还
                                                                            </a>
                                                                        </li>

                                                                        <li class="isToSrc" value="0">
                                                                            <a data-toggle="tab" id="vacation" href="#profile">
                                                                                非原卡退还
                                                                                <!--<span class="badge badge-danger">4</span>-->
                                                                            </a>
                                                                        </li>
                                                                    </ul>
                                                                    <div class="tab-content">
                                                                        <div id="home" class="tab-pane in active">
                                                                            <div class="row">
                                                                                <div class="col-xs-12">

                                                                                    <div class="radio">
                                                                                        <label>
                                                                                            <input name="isAppoint" type="radio" value="1"
                                                                                                   class="ace">
                                                                                            <span class="lbl">退回到一张卡</span>
                                                                                        </label>
                                                                                        <label>
                                                                                            <input name="isAppoint" type="radio" value="0"
                                                                                                   class="ace">
                                                                                            <span class="lbl">全部原卡退还</span>
                                                                                        </label>
                                                                                    </div>
                                                                                    <br/>
                                                                                    <span class="red">注：“退回到一张卡”:将所有金额退还到您选择的卡号上。请慎选卡号。</span>
                                                                                    <br/>
                                                                                    <div class="table-responsive">
                                                                                        <table id="sample-table-2"  class="table table-striped table-bordered table-hover">
                                                                                            <thead>
                                                                                            <tr>
                                                                                                <th hidden>收款分配表ID</th>
                                                                                                <th></th>
                                                                                                <th>序号</th>
                                                                                                <th>退款金额</th>
                                                                                                <th>退款金额大写</th>
                                                                                                <th>持卡人</th>
                                                                                                <th>开户行支行</th>
                                                                                                <th>退款银行卡号</th>
                                                                                            </tr>
                                                                                            </thead>
                                                                                            <tbody>
                                                                                            <#if refundInfoGriddatas?? && (refundInfoGriddatas?size > 0) >
                                                                                                <#list refundInfoGriddatas as refundInfoGriddata>
                                                                                                    <tr>
                                                                                                        <td hidden>${(refundInfoGriddata.financeDistributionId)!''}</td>
                                                                                                        <td class="center">
                                                                                                            <label>
                                                                                                                <input type="checkbox"
                                                                                                                       class="ace" name="checkCardInfo" />
                                                                                                                <span class="lbl"></span>
                                                                                                            </label>
                                                                                                        </td>
                                                                                                        <td>${refundInfoGriddata_index+1}</td>
                                                                                                        <td>${(refundInfoGriddata.distributionAmount)!''}</td>
                                                                                                        <td>${(refundInfoGriddata.upperCaseDistributionAmount)!''}</td>
                                                                                                        <td>
                                                                                                            ${(refundInfoGriddata.payAccountName)!''}
                                                                                                        </td>
                                                                                                        <td>
                                                                                                            ${(refundInfoGriddata.bankName)!''}
                                                                                                        </td>
                                                                                                        <td>${(refundInfoGriddata.payAccountNumber)!''}</td>
                                                                                                    </tr>
                                                                                                </#list>
                                                                                            </#if>
                                                                                            </tbody>
                                                                                        </table>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div id="profile" class="tab-pane">

                                                                            <!-- 退款人 -->
                                                                            <div class="form-group">
                                                                                <label class="col-sm-2 control-label no-padding-right" for="bankAccountName"> 退款人： </label>
                                                                                <div class="col-sm-7">
                                                                                    <div class="clearfix">
                                                                                        <input type="text" id="bankAccountName" name="bankAccountName"
                                                                                               class="col-xs-10 col-sm-5" value="" />
                                                                                        <label class="red"> &nbsp;&nbsp;*</label>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <!-- 开户行 -->
                                                                            <div class="form-group">
                                                                                <label class="col-sm-2 control-label no-padding-right" for="bankName"> 开户行： </label>
                                                                                <div class="col-sm-7">
                                                                                    <div class="clearfix">
                                                                                        <input type="text" id="bankName"  name="bankName"
                                                                                               class="col-xs-10 col-sm-5" value="" />
                                                                                        <label class="red"> &nbsp;&nbsp;*</label>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <!-- 退款银行卡号 -->
                                                                            <div class="form-group">
                                                                                <label class="col-sm-2 control-label no-padding-right" for="bankAccountNumber"> 退款银行卡号： </label>
                                                                                <div class="col-sm-7">
                                                                                    <div class="clearfix">
                                                                                        <input type="text" id="bankAccountNumber"  name="bankAccountNumber"
                                                                                               class="col-xs-10 col-sm-5" value="" />
                                                                                        <label class="red"> &nbsp;&nbsp;*</label>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!--流程选择框-->
                                                <div id="refundFlow" class="hide cssClass">
                                                    <br/>
                                                    <div class="row">
                                                        <div class="col-xs-12">
                                                            <div class="form-group">
                                                                <div class="col-sm-12">
                                                                    <h4 class="red">请选择要发起的流程:</h4>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-xs-12">
                                                                <div class="form-group">
                                                                    <div class="col-sm-12">
                                                                        <select id="refundFlows" name="flowId" data-placeholder="请选择流程"
                                                                                url="../../flow/initFlowOption?flowType=refund">
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                        </div>
                                                    </div>
                                                    <br/>
                                                </div>
                                                <!-- 退款申请附件 -->
                                                <div class="panel panel-default">
                                                    <div class="panel-heading">
                                                        <a href="#faq-1-7" data-toggle="collapse" class="accordion-toggle" aria-expanded="false">
                                                            <i class="pull-right ace-icon fa fa-chevron-down" data-icon-hide="ace-icon fa fa-chevron-down" data-icon-show="ace-icon fa fa-chevron-left"></i>
                                                            &nbsp; 退款申请附件
                                                        </a>
                                                    </div>
                                                    <div class="panel-collapse collapse in" id="faq-1-7" aria-expanded="false">
                                                        <div class="panel-body">
                                                            <div class="form-group">
                                                                <label class="col-sm-3 control-label no-padding-right" for="uploadFile">
                                                                    <!--请上传退款申请附件-->
                                                                </label>
                                                                <div class="col-sm-9">
                                                                    <div class="clearfix">
                                                                        <input type="hidden" id="orderAttachmentNames" name="orderAttachmentName"/>
                                                                        <input type="hidden" id="orderAttachmentUrls" name="orderAttachmentUrl"/>
                                                                        <input type="file" id="uploadFile" name="uploadFile" class="col-xs-10 col-sm-5">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- 附件展示区 -->
                                                            <div class="form-group">
                                                                <div id="houseContent" class="tab-pane">
                                                                    <ul class="ace-thumbnails" id="attImg">

                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="clearfix form-actions">
                                        <div class="col-md-offset-3 col-md-9">
                                            <@shiro.hasPermission name="financial:orderrefundapply:refundapply">
                                            <button id="subRefundApplyBtn" class="btn btn-info" type="button">
                                                <i class="ace-icon fa fa-check bigger-110"></i>
                                                提交审核
                                            </button>
                                            </@shiro.hasPermission>
                                            &nbsp; &nbsp; &nbsp;
                                            <button id="btnReset" class="btn" type="reset">
                                                <i class="ace-icon fa fa-undo bigger-110"></i>
                                                返回
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </body>

    <script type="text/javascript">
        /*全局根路径变量*/
        var refundPaths = "${basePath}"

        <#if !orderInfo??>
        Common.alert("或数据有变化，请刷新列表后再试！",false,function () {
            location.href = refundPaths+"/financial/orderrefundapply/index";
            Common.showMask();
        });
        </#if>

        //删除附件
        function deleteFj(target){
            Common.confirm("确定删除该附件吗?",function(){
                Common.messageBox("提示","删除成功!",true);
                $(target).parent().parent().remove();
                refreshFjs();
            })
        }

        //刷新附件
        function refreshFjs(){
            var fjjs ='';
            var fjjnames = '';
            $("input[name=img_url]").each(function(){
                if(fjjs == ''){
                    fjjs = $(this).val();
                }else{
                    fjjs += ';' + $(this).val();
                }
            });
            $("input[name=img_name]").each(function(){
                if(fjjnames == ''){
                    fjjnames = $(this).val();
                }else{
                    fjjnames += ';' + $(this).val();
                }
            });
            $("#orderAttachmentNames").val(fjjnames);
            $("#orderAttachmentUrls").val(fjjs);
            //初始化画廊
            $('.ace-thumbnails [data-rel="colorbox"]').colorbox(Common.colorbox_params);
        }
    </script>
    <script type="text/javascript" src="../../assets/module/order/vacationOrRefund/refundApply.js"></script>

</html>